<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script type="text/javascript" src="https://static.nid.naver.com/js/naverLogin_implicit-1.0.3.js" charset="utf-8"></script>
    <script type="text/javascript" src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.2.js" charset="utf-8"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
</head>
<body>
    <script type="text/javascript">
        var naver_id_login = new naver_id_login("k8cnRfEmk36R8WL53bbW", "http://127.0.0.1:5500/callback.html");
        // 접근 토큰 값 출력
        // alert(naver_id_login.oauthParams.access_token);
        // 네이버 사용자 프로필 조회
        naver_id_login.get_naver_userprofile("naverSignInCallback()");

        let jsonInfo = null;
        // 네이버 사용자 프로필 조회 이후 프로필 정보를 처리할 callback function
        function naverSignInCallback() {

            let loginInfo = new Object();
            // loginInfo.id = naver_id_login.getProfileData('id');
            loginInfo.nm = naver_id_login.getProfileData('name');
            loginInfo.email = naver_id_login.getProfileData('email');
            loginInfo.genderstr = naver_id_login.getProfileData('gender');
            loginInfo.age = naver_id_login.getProfileData('age');
            loginInfo.birthday = naver_id_login.getProfileData('birthday');
            loginInfo.mobile = naver_id_login.getProfileData('mobile');
            // jsonInfo = JSON.stringify(loginInfo); // 자바스크립트 객체를 문자열로 변환함.
            jsonInfo = JSON.stringify(loginInfo); // JSON 형식의 문자열을 자바스크립트 객체로 변환함.
            document.write(jsonInfo)
            document.write(JSON.stringify(loginInfo))
            // let url = "http://"+window.location.hostname +
            //     ((location.port == '' || location.port == undefined) ? "" : ":"+location.port)+"/user/login";
            PostToJson(jsonInfo);
            window.opener.location.href='/main.html'
        }

        function PostToJson(jsonInfo) {
            let url = "http://localhost:8090/login";
            fetch(url, {
                method: 'post',
                headers: { "Content-Type": "application/json"},
                body: jsonInfo
            }).then((res) => {
                self.close();
                return res.json()
            }).then((data) => {
            }).catch((e) =>{
                console.log(e);
            })
        }

        function makeform(jsonInfo){
            //let url = "http://localhost:8090/login";
            let url = "/login.html";
            
            let name = ['name', 'email', 'gender', 'age', 'birthday']
            let name2 = [jsonInfo.name, jsonInfo.email, jsonInfo.gender, jsonInfo.age, jsonInfo.birthday]
            
            let body = document.querySelector('body');
            let form = document.createElement('form')

            form.action = url
            form.method = 'get'
            
            body.append(form)
            for(let i = 0; i < name.length; i++) {
                let input = document.createElement('input')
                input.type = 'hidden'
                input.name = name[i];
                input.value = name2[i]
                console.log(name2[i])
                form.append(input)
                window.opener.sessionStorage.setItem(name[i],name2[i]);
            }

            
            // form.submit();

        }
    </script>
</body>
</html>